---
title: "EDA VIS canções"
subtitle: 'Análise sobre Jackson do Pandeiro'
author: "José Benardi de Souza Nunes"
output:
  html_notebook:
    toc: yes
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
---

```{r}
library(tidyverse)
library(dplyr, warn.conflicts = FALSE)
library(here)
library(plotly)
library(highcharter)
theme_set(theme_bw())
```

## Data Overview

```{r}
data <- read_csv(here::here("data/jackson.csv"), 
                            col_types = cols(
                                .default = col_double(),
                                album_uri = col_character(),
                                album_name = col_character(),
                                album_img = col_character(),
                                album_release_date = col_character(),
                                album_release_year = col_date(format = ""),
                                album_popularity = col_integer(),
                                track_name = col_character(),
                                track_uri = col_character(),
                                key = col_character(),
                                mode = col_character(),
                                time_signature = col_integer(),
                                key_mode = col_character(),
                                track_popularity = col_integer()
                                ))
data %>% 
    glimpse()
```

### Danceability

```{r}
data %>% 
    ggplot(aes(sample=danceability)) + 
        stat_qq()
```

```{r}
data %>% 
    ggplot(aes(danceability, ..density..)) +
    geom_histogram(binwidth = 0.05,
                   fill="grey",
                   color="black") +
    scale_x_continuous(breaks=seq(0,1,0.05)) 
```

### Speechines

```{r}
data %>% 
    ggplot(aes(sample=speechiness)) + 
        stat_qq()
```

```{r}
data %>% 
    ggplot(aes(speechiness, ..density..)) +
    geom_histogram(binwidth = 0.1,
                   fill="grey",
                   color="black") +
    scale_x_continuous(breaks=seq(-0.05,1,0.1)) 

```

### Duration

```{r}
data <- data %>%
    mutate(duration_s = duration_ms/1000)

data %>% 
    select(duration_s) %>%
    glimpse()
```


```{r}
data %>% 
    ggplot(aes(sample=duration_s)) + 
        stat_qq()
```

```{r}
data %>% 
    ggplot(aes(duration_s, ..density..)) +
    geom_histogram(binwidth = 15,
                   fill="grey",
                   color="black") +
    scale_x_continuous(breaks=seq(0,300,10)) 
```

## Mais discurso/diálogo (speechines) tem efeito sobre a dançabilidade da música?

```{r}
p <- data %>% 
        group_by(track_name) %>%
        unique() %>%
        ggplot(aes(x=speechiness,
                   y=danceability)) +
        geom_point(alpha=0.4) 

ggplotly(p)
```

```{r}
data %>% 
    group_by(track_name) %>%
    unique() %>%
    ggplot(aes(speechiness,danceability)) +
    stat_density2d(aes(fill = ..level..), geom = "polygon")
```

```{r}
data %>%
    group_by(track_name) %>%
    top_n(10, speechiness)
```

## Como o passar dos anos afeta o tempo de duração da música?

Ultimo album "1981: Isso é que é Forró!"


```{r}
data <- data %>%
    mutate(remaster = album_release_date > "1981-30-12")
```

```{r}
data %>% 
    ggplot(aes(x=as.factor(album_release_year),
               duration_s,
               group=album_release_year,
               color=remaster)) +
    geom_jitter(position = position_dodge(width = 0.9),
                alpha=0.3) +
    geom_boxplot(outlier.colour = NA,position = "dodge", alpha=0.6) +
    theme(axis.text.x = element_text(angle = 30, hjust = 1))

```

#### Os albuns lançados mais recentemente (relançamentos/remasterizados) são mais populares? 

```{r}
# lollipop chart
m <- list(
  l = 505)

p <- data %>%
        ggplot(aes(album_popularity,y=reorder(album_name,album_popularity),color=remaster)) +
            geom_segment(aes(x = 0, y = reorder(album_name,album_popularity), 
                             xend = album_popularity, 
                             yend = album_name),
                         color = "grey50") + 
        geom_point() +
        theme(axis.title.y=element_blank())

ggplotly(p) %>%
  layout(autosize = F,
         margin = m,
         height=600,
         width=800)
```


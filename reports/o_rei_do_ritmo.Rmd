---
title: "EDA VIS canções"
subtitle: 'Análise sobre Jackson do Pandeiro'
author: "José Benardi de Souza Nunes"
output:
  html_notebook:
    toc: yes
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
---

```{r}
library(tidyverse)
library(dplyr, warn.conflicts = FALSE)
library(here)
library(plotly)
library(scales)
library(highcharter)
library(stringr)
theme_set(theme_bw())
```

## Data Overview

```{r}
data <- read_csv(here::here("data/jackson.csv"), 
                            col_types = cols(
                                .default = col_double(),
                                album_uri = col_character(),
                                album_name = col_character(),
                                album_img = col_character(),
                                album_release_date = col_character(),
                                album_release_year = col_date(format = ""),
                                album_popularity = col_integer(),
                                track_name = col_character(),
                                track_uri = col_character(),
                                key = col_character(),
                                mode = col_character(),
                                time_signature = col_integer(),
                                key_mode = col_character(),
                                track_popularity = col_integer()
                                )) %>%
         mutate(album_name = gsub(".*(1954).*",
                                         "The Music of Brazil/Jackson do Pandeiro",
                                  album_name));
data %>% 
    glimpse()
```

### Danceability

```{r}
data %>% 
    ggplot(aes(sample=danceability)) + 
        stat_qq()
```

```{r}
hchart (data$danceability,
        color = "#B71C1C",
        name = "Dançabilidade")
```


### Speechines

```{r}
data %>% 
    ggplot(aes(sample=speechiness)) + 
        stat_qq()
```

```{r}
hchart (data$speechiness,
        color = "#B71C1C",
        name = "Verbosidade")
```

### Duration

```{r}
data <- data %>%
    mutate(duration_s = duration_ms/1000)

data %>% 
    select(duration_s) %>%
    glimpse()
```


```{r}
data %>% 
    ggplot(aes(sample=duration_s)) + 
        stat_qq()
```

```{r}
hchart (data$duration_s,
        color = "#B71C1C",
        name = "Duração (s)")
```

### Remaster

Ultimo album "1981: Isso é que é Forró!"

```{r}
data <- data %>%
    mutate(remaster = album_release_date > "1981-30-12")

data %>% 
    select(album_name, album_release_year, remaster) %>%
    sample_n(10)
```


```{r}
temp <- data %>% 
    distinct(album_name,
             .keep_all = TRUE) %>%
    mutate(remaster = ifelse(remaster == TRUE,"remasterizado","original"))

hchart(temp$remaster,
       colorByPoint = TRUE,
       name="Álbum")
```



## Mais discurso/diálogo (speechines) tem efeito sobre a dançabilidade da música?

```{r}
p <- data %>% 
        distinct(track_name, .keep_all = TRUE) %>%
        ggplot(aes(x=speechiness,
                   y=danceability)) +
        geom_point(alpha=0.4) 

ggplotly(p)
```

A dançabilidade das músicas de Jackson

```{r}
data %>% 
    distinct(track_name, .keep_all = TRUE) %>%
    ggplot(aes(speechiness,danceability)) +
    stat_density2d(aes(fill = ..level..), geom = "polygon")
```

```{r}
data %>%
    group_by(track_name) %>%
    top_n(10, speechiness)
```

## Como o passar dos anos afeta o tempo de duração da música?

```{r}
temp <-
    data %>% 
    distinct(album_name, .keep_all = TRUE) %>%
    group_by(album_release_year) %>%
    summarise(original_n = sum(!remaster),
              remaster_n = sum(remaster))

highchart() %>%

  hc_xAxis(categories = temp$album_release_year) %>%
  hc_add_series(temp$original_n, 
                type = "column",
                color = "#B71C1C",
                name = "Não remasterizado") %>%
  hc_add_series(temp$remaster_n, 
                type = "column",
                name = "Remasterizado")  %>%
      hc_title(text = "Número de álbuns por ano")

```

```{r}
m <- list(
  l =70,
  b = 150)

p <- data %>% 
    ggplot(aes(x=as.factor(album_release_year),
               duration_s,
               group=album_release_year,
               color=remaster)) +
    geom_boxplot(position = "dodge", alpha=0.6) +
    theme(axis.text.x = element_text(angle = 30, hjust = 1))

ggplotly(p) %>%
     layout(autosize = F, margin=m)
```

## Os albuns relançados/remasterizados são mais populares? 

```{r}
# lollipop chart
m <- list(
  l = 370)

p <- data %>%
        ggplot(aes(album_popularity,y=reorder(album_name,album_popularity),
                   color=remaster,
                   group=remaster)) +
            geom_segment(aes(x = 0, y = reorder(album_name,album_popularity), 
                             xend = album_popularity, 
                             yend = album_name)) + 
        geom_point() +
        theme(axis.title.y=element_blank())

ggplotly(p,tooltip=NA) %>%
  layout(autosize = F,
         margin = m)
```

## De Qual nota são as faixas mais populares?


```{r}
# tim12equal = c("#00008F", "#0000EA", "#0047FF", "#00A2FF", "#00FEFF", "#5AFFA5", "#B5FF4A", "#FFED00", "#FF9200", "#FF3700", "#DB0000", "#800000")
# 
# m <- list(
#     b = 70);
# 
# p <- 
#  data %>%
#     select(key,album_release_date) %>%
#     group_by(album_release_date,key) %>%
#     summarise(count = n()) %>%
#     mutate(prop = count/sum(count)) %>%
#     ungroup() %>%
#     ggplot(aes(x = factor(album_release_date), y = count, fill = key)) +
#     geom_bar(stat = "identity", position = "fill", width = .7)  +
#     scale_y_continuous(labels = scales::percent) +
#     scale_fill_manual(values = tim12equal) +
#     theme(axis.text.x = element_text(angle = 30, hjust = 1)) + 
#     ggtitle("Distribuição de notas musicais temporalmente")
# 
# 
# ggplotly(p) %>%
#       layout(autosize = F,
#              margin = m)
```




```{r}
tim12equal = c("#00008F", "#0000EA", "#0047FF", "#00A2FF", "#00FEFF", "#5AFFA5", "#B5FF4A", "#FFED00", "#FF9200", "#FF3700", "#DB0000", "#800000")


m <- list(
    l=80,
    r=30);

p <-  data %>%
    select(key,album_release_date, remaster) %>%
    group_by(album_release_date,key,remaster) %>%
    summarise(count = n()) %>%
    mutate(prop = count/sum(count)) %>%
    ungroup() %>%
    ggplot(aes(x = factor(album_release_date), y = count, fill = key)) +
    geom_bar(stat = "identity", position = "fill", width = .7)  +
    scale_y_continuous(labels = scales::percent) +
    scale_fill_manual(values = tim12equal) +
    theme(axis.text.x = element_text(angle = 30, hjust = 1))  +
    theme(axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
    facet_grid(remaster ~ .) +
    ggtitle("Notas musicais (distinção por remasterização)") +
    guides(fill=guide_legend(title=""))

ggplotly(p) %>%
      layout(autosize = F,
             margin = m,
             legend = list(
      orientation = "h", y =-0.2
    ))

```

É possível ver que no começo dos anos 1960 ínicio as músicas na escala entre E e G dominam fortemente o repertório de Jackson, curiosamente quando as músicas de notas entre A e C chegam a ocupar metade das ocorrências. Isso está de acordo com o perfil de Jackson, notório por sua heterogeneidade.



